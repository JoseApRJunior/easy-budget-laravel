{% extends 'layout.twig' %}

{% block content %}
<div class="container-fluid py-1">
	<!-- Cabeçalho da página -->
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1 class="h3 mb-0">
			<i class="bi bi-file-earmark-plus me-2"></i>Novo Orçamento
		</h1>
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb mb-0">
				<li class="breadcrumb-item"><a href="/provider">Dashboard</a></li>
				<li class="breadcrumb-item"><a href="/provider/budgets">Orçamentos</a></li>
				<li class="breadcrumb-item active">Novo</li>
			</ol>
		</nav>
	</div>

	<!-- Formulário -->
	<div class="card border-0 shadow-sm">
		<div class="card-body p-4">
			<form id="create-budget-form" action="/provider/budgets/create" method="POST">
				{{ csrf.field|raw }}
				<!-- Seção de Cliente -->
				<div class="row g-4">
					<div class="col-md-4">
						<div class="form-group">
							<label for="search-input" class="form-label fw-semibold">
								<i class="bi bi-search me-2"></i>Buscar Cliente
							</label>
							<div class="input-group">
								<input type="search" id="search-input" name="search-input" class="form-control"
									placeholder="Nome, CPF ou CNPJ" autocomplete="off" />
								<span class="input-group-text bg-light">
									<i class="bi bi-search text-muted"></i>
								</span>
							</div>
						</div>
					</div>

					<div class="col-md-4">
						<div class="form-group">
							<label for="customer" class="form-label fw-semibold">
								<i class="bi bi-person me-2"></i>Cliente Selecionado
							</label>
							<input type="text" id="customer" name="customer" class="form-control bg-light" disabled required />
							{{ flash('customer_name')|raw }}

							<!-- Lista de sugestões -->
							<div class="position-relative">
								<ul id="suggestions-list" class="list-group position-absolute w-100 mt-1 shadow-sm rounded-3"></ul>
							</div>
						</div>
					</div>

					<!-- Campos ocultos -->
					<input type="hidden" id="customer_id" name="customer_id" />
					<input type="hidden" id="customer_name" name="customer_name" />
					<input type="hidden" id="phone" name="phone" />
					<input type="hidden" id="email" name="email" />

					<!-- Data de Vencimento -->
					<div class="col-md-4">
						<div class="form-group">
							<label for="due-date" class="form-label fw-semibold">
								<i class="bi bi-calendar me-2"></i>Previsão de Vencimento
							</label>
							<input type="date" id="due-date" name="due_date" class="form-control"
								value="{{ oneMonthAhead|date('Y-m-d') }}" min="{{ " now"|date('Y-m-d') }}" />
							{{ flash('due_date')|raw }}
						</div>
					</div>

					<!-- Descrição -->
					<div class="col-12">
						<div class="form-group">
							<label for="description" class="form-label fw-semibold">
								<i class="bi bi-card-text me-2"></i>Descrição
							</label>
							<textarea id="description" name="description" class="form-control" rows="4" maxlength="255"
								placeholder="Ex: Pintura residencial completa"></textarea>
							<div class="d-flex justify-content-end">
								<small id="char-count" class="text-muted mt-2">
									<span>255</span> caracteres restantes
								</small>
							</div>
						</div>
					</div>

					<!-- Condições de Pagamento (opcional) -->
					<div class="col-12">
						<div class="form-group">
							<label for="payment_terms" class="form-label fw-semibold">
								<i class="bi bi-credit-card me-2"></i>Condições de Pagamento
							</label>
							<textarea id="payment_terms" name="payment_terms" class="form-control" rows="2" maxlength="255"
								placeholder="Ex: Pagamento em 2x no cartão ou à vista com 5% de desconto">{{ budget.payment_terms }}</textarea>
							{{ flash('payment_terms')|raw }}
						</div>
					</div>
				</div>

				<!-- Botões de ação -->
				<div class="d-flex justify-content-between mt-4 pt-4 border-top">
					<button type="button" onclick="history.back()" class="btn btn-outline-secondary px-4">
						<i class="bi bi-arrow-left me-2"></i>Voltar
					</button>
					<button type="submit" class="btn btn-primary px-4">
						<i class="bi bi-check-lg me-2"></i>Criar Orçamento
					</button>
				</div>
			</form>
		</div>
	</div>
</div>
{% endblock %}

{% block scripts %}
{{ parent() }}
<!-- Inclusão dos plugins de máscara -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script src="/assets/js/modules/masks/masks.js" type="module"></script>
<!-- Script próprio para gerenciamento do orçamento -->
<script>
	let customers = JSON.parse( '{{ customers | json_encode | e("js") }}' );
</script>
<script src="/assets/js/budget_create.js"></script>
{% endblock %}
