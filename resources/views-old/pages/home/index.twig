{# pages/home/index.twig #}
{% extends 'layout.twig' %}
{% import 'macros/utils.twig' as utils %}
{% block content %}
<!-- Banner Principal com gradiente e animação -->
<section id="home" class="hero-section text-center position-relative mt-5">
	<div class="hero-overlay"></div>
	<div class="main-container position-relative">
		<!-- Alerta de teste -->
		<div class="alert alert-warning alert-dismissible fade show mb-4" role="alert">
			<i class="bi bi-exclamation-triangle-fill me-2"></i>
			<strong>Ambiente de Testes!</strong> Os dados podem ser resetados a qualquer momento. Não utilize dados reais.
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>

		<div class="hero-content">
			<h1 class="display-4 fw-bold mb-3">Bem-vindo ao Easy Budget</h1>
			<p class="lead mb-4">Transforme a gestão de seus serviços com nossas soluções diversificadas e inovadoras.</p>
			<button id="conhecaPlanos" class="btn btn-primary btn-lg pulse-button">
				<i class="bi bi-arrow-down-circle me-2"></i>Conheça nossos planos
			</button>
		</div>
	</div>
</section>

<!-- Seção de Planos -->
<section id="plans" class="py-5">
	<div class="main-container">
		<div class="section-header text-center mb-5">
			<h2 class="display-6 fw-bold">Escolha o Plano Perfeito para Você</h2>
			<p class="small-text">Selecione o plano que melhor atende às suas necessidades</p>
		</div>

		<div class="row row-cols-1 row-cols-md-3 g-4 mb-5">
			{% for plan in plans %}
			<div class="col">
				<div class="card h-100 shadow-sm hover-card">
					{% set cardContent %}
					<div class="card-body d-flex flex-column">
						<div class="text-center mb-4">
							{% if entityProperty(plan, 'slug') == 'free' %}
							<i class="bi bi-rocket display-6 text-primary mb-2"></i>
							{% elseif entityProperty(plan, 'slug') == 'basic' %}
							<i class="bi bi-star display-6 text-success mb-2"></i>
							{% else %}
							<i class="bi bi-gem display-6 text-info mb-2"></i>
							{% endif %}
							<h3 class="card-title h4">{{ entityProperty(plan, 'name') }}</h3>
							<div class="pricing-header">
								<span class="currency">R$</span>
								<span class="price">{{ entityProperty(plan, 'price')|number_format(0, '', '.') }}</span>
								<span class="period">/mês</span>
							</div>
						</div>

						<p class="card-text small-text mb-4">{{ entityProperty(plan, 'description') }}</p>

						<ul class="feature-list list-unstyled mb-4">
							{% for feature in entityProperty(plan, 'features') %}
							<li class="mb-2">
								<i class="bi bi-check-circle-fill text-success me-2"></i>
								{{ feature }}
							</li>
							{% endfor %}
						</ul>

						<button type="button" class="btn btn-outline-primary btn-lg mt-auto w-100 select-plan"
							data-plan="{{ entityProperty(plan, 'name') }}" data-target="#preCadastroForm">
							<i class="bi bi-arrow-right-circle me-2"></i>Selecionar
						</button>
					</div>
					{% endset %}
					{{ utils.checkFeature('plan-listing', cardContent, entityProperty(plan, 'slug') != 'free') }}
				</div>
			</div>
			{% endfor %}
		</div>

		<!-- Formulário de Pré-Cadastro -->
		<div id="preCadastroForm" class="card shadow-lg border-0 rounded-3">
			<div class="card-header py-3">
				<h5 class="card-title text-center mb-0">
					<i class="bi bi-person-plus me-2"></i>Pré-Cadastro
				</h5>
			</div>
			<div class="card-body p-4">
				<form action="/register" method="POST" id="preRegisterForm" class="needs-validation" novalidate>
					{{ csrf.field|raw }}
					<div class="row g-3">
						<div class="col-md-3">
							<label for="plan" class="form-label">Plano Selecionado</label>
							<select class="form-select" id="planSelect" name="plan" required>
								{% for plan in plans %}
								<option value="{{ entityProperty(plan, 'slug') }}" {{ entityProperty(plan, 'slug' ) !='free'
									? 'disabled' : '' }}>{{ entityProperty(plan, 'name') }}
									- R$
									{{ entityProperty(plan, 'price')|number_format(2, ',', '.') }}{{ entityProperty(plan, 'slug') !=
									'free' ? ' - em desenvolvimento' : '' }}
								</option>
								{% endfor %}
							</select>
							{{ flash('plan')|raw }}
						</div>

						<div class="col-md-3">
							<label for="firs_name" class="form-label">Nome</label>
							<input type="text" class="form-control" id="first_name" name="first_name" required />
							{{ flash('first_name')|raw }}
						</div>

						<div class="col-md-3">
							<label for="last_name" class="form-label">Sobrenome</label>
							<input type="text" class="form-control" id="last_name" name="last_name" required />
							{{ flash('last_name')|raw }}
						</div>

						<div class="col-md-3">
							<label for="email" class="form-label">Email</label>
							<input type="email" class="form-control" id="email" name="email" required />
							{{ flash('email')|raw }}
						</div>

						<div class="col-md-3">
							<label for="phone" class="form-label">Telefone</label>
							<input type="tel" class="form-control" id="phone" name="phone" required />
							{{ flash('phone')|raw }}
						</div>

						<div class="col-md-3">
							<label for="password" class="form-label">Senha</label>
							<div class="password-container">
								<input type="password" class="form-control" id="password" name="password" required />
								<button type="button" class="password-toggle" data-input="password">
									<i class="bi bi-eye"></i>
								</button>
							</div>
							{{ flash('password')|raw }}
							<div class="password-rules" style="display:none;">
								<ul>
									<li>
										<i class="fas fa-check-circle" style="color: #ccc;"></i>
										Pelo menos 6 caracteres
									</li>
									<li>
										<i class="fas fa-check-circle" style="color: #ccc;"></i>
										Letras minúsculas (a-z)
									</li>
									<li>
										<i class="fas fa-check-circle" style="color: #ccc;"></i>
										Letras maiúsculas (A-Z)
									</li>
									<li>
										<i class="fas fa-check-circle" style="color: #ccc;"></i>
										Números (0-9)
									</li>
									<li>
										<i class="fas fa-check-circle" style="color: #ccc;"></i>
										Caracteres especiais (@#$!%*?&)
									</li>
								</ul>
							</div>
						</div>

						<div class="col-md-3">
							<label for="confirm_password" class="form-label">Confirmar Senha</label>
							<div class="password-container">
								<input type="password" class="form-control" id="confirm_password" name="confirm_password" required />

								<button type="button" class="password-toggle" data-input="confirm_password">
									<i class="bi bi-exclamation-circle error-icon d-none"></i>
									<i class="bi bi-eye"></i>
								</button>
							</div>
							{{ flash('confirm_password')|raw }}
						</div>

						<div class="col-md-3">
							<label class="form-label">&nbsp;</label>
							<button type="submit" class="btn btn-primary w-100">
								<i class="bi bi-send me-2"></i>Enviar Pré-Cadastro
							</button>
						</div>

						<div class="mt-4 text-center">
							<div class="form-check mb-3">
								<label class="form-check-label" for="terms_accepted">
									<input class="form-check-input" type="checkbox" id="terms_accepted" name="terms_accepted" required />
									{{ 'Eu li e aceito os' }}
									<a href="/terms-of-service" target="_blank">{{ 'Termos de Serviço' }}</a>
									{{ 'e a' }}
									<a href="/privacy-policy" target="_blank">{{ 'Política de Privacidade' }}</a>.
								</label>
							</div>
							{{ flash('terms_accepted')|raw }}
							<small class="small-text d-block mb-3">{{ 'Ao se cadastrar, você concorda em receber atualizações sobre
								nossos serviços por e-mail. Você pode cancelar a qualquer momento.' }}</small>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</section>
{% endblock %}
