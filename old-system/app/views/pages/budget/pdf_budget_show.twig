{% extends "layout_pdf_base.twig" %}
{% block title %}Detalhes do Orçamento - {{ budget.code }}{% endblock %}
{% block content %}
<div class="report-container">
  <div class="report-header">
    <table class="header-content" style="width: 100%;">
      <tr>
        <td style="width: 50%; vertical-align: top;">
          <div class="company-info">
            <h2 style="font-size: 24px; margin-bottom: 10px; color: #2c3e50;">
              {{ auth().company_name }}
            </h2>
            <div class="company-details">
              <div style="margin-bottom: 5px; font-size: 11px;">
                <span style="margin-right: 8px;">➤</span>
                <span>{{ auth().address }}</span>
              </div>
              <div style="margin-bottom: 5px; font-size: 11px;">
                <span style="margin-right: 8px;">⚑</span>
                <span>{% if auth().cnpj %}CNPJ: {{ auth().cnpj }}{% else %}CPF: {{ auth().cpf }}{% endif %}</span>
              </div>
              <div style="margin-bottom: 5px; font-size: 11px;">
                <span style="margin-right: 8px;">☎</span>
                <span>{% if auth().phone_business %}{{ auth().phone_business }}{% else %}{{ auth().phone }}{% endif
                  %}</span>
              </div>
              <div style="margin-bottom: 5px; font-size: 11px;">
                <span style="margin-right: 8px;">✉</span>
                <span>{% if auth().email_business %}{{ auth().email_business }}{% else %}{{ auth().email }}{% endif
                  %}</span>
              </div>
            </div>
          </div>
        </td>
        <td style="width: 50%; vertical-align: top; text-align: right;">
          <div class="report-title">
            <h1 style="font-size: 24px; margin-bottom: 10px; color: #2c3e50;">
              Orçamento #{{ budget.code }}
            </h1>
            <div style="color: #666;">
              <div style="margin-bottom: 5px; font-size: 11px;">
                <span style="font-weight: 600; margin-right: 5px;">Cliente:</span>
                <span> {{ customer.first_name}} {{ customer.last_name}}</span>
              </div>
              <div style="margin-bottom: 5px; font-size: 11px;">
                <span style="font-weight: 600; margin-right: 5px;">Status:</span>
                <span style="color: {{ budget.status_color }} !important; font-weight: bold;">{{ budget.status_name
                  }}</span>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
  <hr style="border: 0; border-top: 1px solid #eee; ">
  <div class="section">
    <h3 style="font-size: 18px; color: #2c3e50; margin-bottom: 10px;">Descrição do Orçamento</h3>
    <p style="font-size: 12px; line-height: 1.4;">{{ budget.description }}</p>
  </div>

  <div class="section">
    <h3 style="font-size: 18px; color: #2c3e50; margin-bottom: 10px;">Detalhes Adicionais</h3>
    <table style="width: 100%; border-collapse: collapse;">
      <tr>
        <td style="width: 50%; vertical-align: top; padding-right: 5px;">
          <div class="card-like" style="border: 1px solid #eee; padding: 10px; margin-bottom: 5px;">
            <h4 style="font-size: 14px; color: #333; margin-bottom: 5px;"><i class="bi bi-person me-2"></i>Detalhes do
              Cliente</h4>
            <div style="font-size: 12px; margin-bottom: 3px;">
              <span style="font-weight: 600;">Telefone:</span> {{ customer.phone_business ? customer.phone_business
              : customer.phone }}
            </div>
            <div style="font-size: 12px;">
              <span style="font-weight: 600;">Email:</span> {{ customer.email_business ? customer.email_business :
              customer.email }}
            </div>
          </div>
        </td>
        <td style="width: 50%; vertical-align: top; padding-left: 5px;">
          <div class="card-like" style="border: 1px solid #eee; padding: 10px; margin-bottom: 5px;">
            <h4 style="font-size: 14px; color: #333; margin-bottom: 5px;"><i class="bi bi-calendar me-2"></i>Informações
              do Orçamento</h4>
            <p style="font-size: 12px; margin-bottom: 3px;">Criado em: {{ budget.created_at | date("d/m/Y H:i:s") }}</p>
            <p style="font-size: 12px;">Vencimento: {{ budget.due_date | date("d/m/Y") }}</p>
          </div>
      </tr>
      {% if budget.payment_terms %}
      <tr>
        <td colspan="2" style="vertical-align: top;">
          <div class="card-like" style="border: 1px solid #eee; padding: 10px; margin-bottom: 5px;">
            <h4 style="font-size: 14px; color: #333; margin-bottom: 5px;"><i
                class="bi bi-credit-card me-2"></i>Condições de Pagamento</h4>
            <p style="font-size: 12px;">{{ budget.payment_terms }}</p>
          </div>
        </td>
      </tr>
      {% endif %}
      {% if budget.attachment or budget.history %}
      <tr>
        <td style="width: 50%; vertical-align: top; padding-right: 5px;">
          {% if budget.attachment %}
          <div class="card-like" style="border: 1px solid #eee; padding: 10px; margin-bottom: 5px;">
            <h4 style="font-size: 14px; color: #333; margin-bottom: 5px;"><i class="bi bi-paperclip me-2"></i>Anexos
            </h4>
            <p style="font-size: 12px;">{{ budget.attachment }}</p>
          </div>
          {% endif %}
        </td>
        <td style="width: 50%; vertical-align: top; padding-left: 5px;">
          {% if budget.history %}
          <div class="card-like" style="border: 1px solid #eee; padding: 10px; margin-bottom: 5px;">
            <h4 style="font-size: 14px; color: #333; margin-bottom: 5px;"><i
                class="bi bi-clock-history me-2"></i>Histórico</h4>
            <p style="font-size: 12px;">{{ budget.history }}</p>
          </div>
          {% endif %}
        </td>
      </tr>
      {% endif %}
    </table>
  </div>
  <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
  <div class="section">
    <h3 style="font-size: 18px; color: #2c3e50; margin-bottom: 10px;">Resumo Financeiro</h3>
    <table style="width: 100%; border-collapse: collapse;">
      <tr>
        <td style="width: 33.33%; padding: 5px 0; font-size: 12px;">
          <span style="font-weight: 600;">Total do Orçamento:</span>
        </td>
        <td
          style="width: 66.67%; text-align: right; padding: 5px 0; font-size: 14px; font-weight: bold; color: #28a745;">
          R$ {{ budget.total|number_format(2, ',', '.') }}
        </td>
      </tr>
      <tr>
        <td style="width: 33.33%; padding: 5px 0; font-size: 12px;">
          <span style="font-weight: 600;">Data de Vencimento:</span>
        </td>
        <td
          style="width: 66.67%; text-align: right; padding: 5px 0; font-size: 12px; {% if budget.due_date|date('Y-m-d') < 'now'|date('Y-m-d') %}color: #dc3545;{% endif %}">
          {{ budget.due_date|date('d/m/Y') }}
        </td>
      </tr>
      <tr>
        <td style="width: 33.33%; padding: 8px 0; font-size: 12px;">
          <span style="font-weight: 600;">Quantidade de Serviços:</span>
        </td>
        <td style="width: 66.67%; text-align: right; padding: 5px 0; font-size: 12px;">
          {{ services|length }}
        </td>
      </tr>
      <tr>
        <td colspan="2" style="padding: 5px 0; font-size: 12px;">
          <span style="font-weight: 600;">Progresso do Orçamento:</span>
          <span style="display: block; margin-top: 3px; font-size: 11px; color: #666;">
            {% if budget.status_slug == 'DRAFT' %}
            Orçamento em elaboração.
            {% elseif budget.status_slug == 'PENDING' %}
            Aguardando aprovação do cliente.
            {% elseif budget.status_slug == 'APPROVED' %}
            Orçamento aprovado, serviços podem ser iniciados.
            {% elseif budget.status_slug == 'COMPLETED' %}
            Orçamento concluído com sucesso.
            {% elseif budget.status_slug == 'REJECTED' %}
            Orçamento rejeitado pelo cliente.
            {% elseif budget.status_slug == 'CANCELLED' %}
            Orçamento cancelado.
            {% elseif budget.status_slug == 'EXPIRED' %}
            Orçamento expirado.
            {% endif %}
          </span>
        </td>
      </tr>
    </table>
  </div>
  <hr style="border: 0; border-top: 1px solid #eee; margin: 5px 0;">
  <div class="section">
    <h3 style="font-size: 18px; color: #2c3e50; margin-bottom: 10px;">Serviços Vinculados</h3>
    {% if services %}
    {% for service in services %}
    <div class="service-card" style="border: 1px solid #eee; padding: 5px; margin-bottom: 5px;">
      <table style="width: 100%; border-collapse: collapse;">
        <!-- Row 1: Code and Status -->
        <tr>
          <td style="vertical-align: top; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0;">
            <div style="font-size: 16px; font-weight: bold; color: #333;">Serviço #{{ service.code }}</div>
            <div style="font-size: 12px; color: #666;">Categoria: {{ service.category_name }}</div>
          </td>
          <td style="text-align: right; vertical-align: top; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0;">
            <span style="font-size: 12px; font-weight: bold; color: {{ service.status_color }} !important;">{{
              service.status_name }}</span>
          </td>
        </tr>
        <!-- Row 2: Description -->
        <tr>
          <td colspan="2">
            <p style="font-size: 12px; line-height: 1.4; margin: 0;">
              <span style="font-weight: 600;">Descrição:</span> {{ service.description }}
            </p>
          </td>
        </tr>
        <!-- Row 3: Due Date and Total -->
        <tr>
          <td style="vertical-align: top; font-size: 12px;">
            <span style="font-weight: 600;">Vencimento:</span> {{ service.due_date|date('d/m/Y') }}
          </td>
          <td style="text-align: right; vertical-align: top; font-size: 12px;">
            <span style="font-weight: 600;">Total do Serviço:</span>
            <span style="font-weight: bold; color: #28a745;">R$ {{ service.total | number_format(2, ',', '.') }}</span>
          </td>
        </tr>
      </table>
      {% if service_items[service.id] %}
      <div style="margin-top: 10px;">
        <h5 style="font-size: 14px; color: #2c3e50; margin-bottom: 5px;">Itens do Serviço:</h5>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th
                style="text-align: left; padding: 3px; font-size: 11px; background-color: #f8f9fa !important; border-bottom: 1px solid #eee;">
                Item</th>
              <th
                style="text-align: right; padding: 3px; font-size: 11px; background-color: #f8f9fa !important; border-bottom: 1px solid #eee;">
                Qtd</th>
              <th
                style="text-align: right; padding: 3px; font-size: 11px; background-color: #f8f9fa !important; border-bottom: 1px solid #eee;">
                Preço Unit.</th>
              <th
                style="text-align: right; padding: 3px; font-size: 11px; background-color: #f8f9fa !important; border-bottom: 1px solid #eee;">
                Total Item</th>
            </tr>
          </thead>
          <tbody>
            {% for service_item in service_items[service.id] %}
            <tr>
              <td style="text-align: left; padding: 3px; font-size: 11px; border-bottom: 1px solid #eee;">{{
                service_item.name }}</td>
              <td style="text-align: right; padding: 3px; font-size: 11px; border-bottom: 1px solid #eee;">{{
                service_item.quantity }}</td>
              <td style="text-align: right; padding: 3px; font-size: 11px; border-bottom: 1px solid #eee;">R$ {{
                service_item.unit_value | number_format(2, ',', '.') }}</td>
              <td style="text-align: right; padding: 3px; font-size: 11px; border-bottom: 1px solid #eee;">R$ {{
                (service_item.price * service_item.quantity) | number_format(2, ',', '.') }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <hr style="border: 0; border-top: 1px solid #eee; ">
      {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <p style="font-size: 12px; color: #666;">Nenhum serviço vinculado a este orçamento.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
{% block styles %}
<style>
  @page {
    size: portrait;
    margin: 15mm;
  }

  body {
    font-family: 'Helvetica Neue', 'Helvetica', Arial, sans-serif;
    color: #333;
    line-height: 1.4;
  }

  .report-container {
    width: 100%;
    margin: 0 auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  .header-content td {
    padding: 0;
  }

  .company-info h2,
  .report-title h1 {
    margin-top: 0;
    margin-bottom: 10px;
  }

  .company-details div,
  .report-title div {
    margin-bottom: 3px;
  }

  .company-details span,
  .report-title span {
    display: inline-block;
  }

  hr {
    border: none;
    border-top: 1px solid #eee;
    margin: 15px 0;
  }

  .section {
    margin-bottom: 15px;
  }

  .section h3 {
    border-bottom: 1px solid #eee;
    padding-bottom: 5px;
    margin-bottom: 10px;
  }

  .card-like {
    border: 1px solid #eee;
    padding: 10px;
    margin-bottom: 5px;
    background-color: #fdfdfd;
  }

  .card-like h4 {
    margin-top: 0;
    margin-bottom: 5px;
    padding-bottom: 5px;
    border-bottom: 1px solid #f0f0f0;
  }

  .service-card {
    border: 1px solid #ddd;
    padding: 15px;
    margin-bottom: 10px;
    background-color: #f9f9f9;
  }

  .service-card h4 {
    margin-top: 0;
    margin-bottom: 3px;
  }

  .service-card p {
    line-height: 1.4;
    margin-bottom: 5px;
  }

  .service-card table {
    margin-top: 10px;
  }

  .service-card table th,
  .service-card table td {
    padding: 3px;
    border-bottom: 1px solid #f0f0f0;
  }

  .service-card table th {
    background-color: #f2f2f2 !important;
  }

  @media print {
    * {
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }

    body {
      -webkit-print-color-adjust: exact;
    }

    .report-container {
      box-shadow: none;
      border: none;
    }
  }
</style>
{% endblock %}
