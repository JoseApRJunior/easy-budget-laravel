{% extends "layout.twig" %}

{% block content %}
<div class="container-fluid py-4">
  <!-- Cabeçalho -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 text-gray-800">
      <i class="bi box me-2"></i>Produtos
    </h1>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="/provider">Dashboard</a></li>
        <li class="breadcrumb-item active">Produtos</li>
      </ol>
    </nav>
  </div>

  <!-- Cards de Ação -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="card h-100 shadow-sm border-0 hover-shadow">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center mb-3">
            <div class="bg-primary bg-opacity-10 p-3 rounded me-3">
              <i class="bi bi-graph-up text-primary"></i>
            </div>
            <h5 class="card-title mb-0">Relatório de Produtos</h5>
          </div>
          <p class="card-text text-muted flex-grow-1">
            Visualize todos os produtos cadastrados no sistema.
          </p>
          <a href="/provider/reports/products" class="btn btn-primary">
            Acessar Relatório
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card h-100 shadow-sm border-0 hover-shadow">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center mb-3">
            <div class="bg-success bg-opacity-10 p-3 rounded me-3">
              <i class="bi bi-plus-circle text-success"></i>
            </div>
            <h5 class="card-title mb-0">Novo Produto</h5>
          </div>
          <p class="card-text text-muted flex-grow-1">
            Cadastre um novo produto no sistema.
          </p>
          <a href="/provider/products/create" class="btn btn-success">
            Criar Produto
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de Produtos -->
  <div class="card shadow-sm border-0">
    <div class="card-header py-3">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">
          <i class="bi bi-list me-2"></i>Produtos Cadastrados
        </h2>
        <div class="d-flex gap-2">
          <div class="input-group">
            <input type="search" class="form-control" placeholder="Buscar produto..." id="searchInput">
            <span class="input-group-text bg-white">
              <i class="bi bi-search"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th scope="col" class="px-4" style="width: 15%">Código</th>
              <th scope="col" style="width: 30%">Nome</th>
              <th scope="col" style="width: 15%">Preço</th>
              <th scope="col" style="width: 15%">Estoque</th>
              <th scope="col" style="width: 15%">Status</th>
              <th scope="col" class="text-end px-4" style="width: 10%">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for product in products %}
            <tr>
              <td class="px-4 align-middle">
                <span class="fw-semibold">{{ product.code }}</span>
              </td>
              <td class="align-middle">
                <div class="d-flex align-items-center">
                  {% if product.image %}
                  <img src="{{ product.image }}" class="rounded me-2" width="40" height="40" alt="{{ product.name }}">
                  {% else %}
                  <div class="bg-secondary bg-opacity-10 rounded me-2 p-2">
                    <i class="bi bi-box text-secondary"></i>
                  </div>
                  {% endif %}
                  <div class="text-truncate" style="max-width: 200px;">
                    {{ product.name }}
                  </div>
                </div>
              </td>
              <td class="align-middle">
                <span class="fw-semibold text-success">
                  {{ 'R$ ' ~ product.price|number_format(2, ',', '.') }}
                </span>
              </td>
              <td class="align-middle">
                <span
                  class="badge bg-{{ product.stock > 0 ? 'success' : 'danger' }} bg-opacity-10 text-{{ product.stock > 0 ? 'success' : 'danger' }}">
                  {{ product.stock }} unidades
                </span>
              </td>
              <td class="align-middle">
                <span class="badge bg-{{ product.active ? 'success' : 'secondary' }}">
                  {{ product.active ? 'Ativo' : 'Inativo' }}
                </span>
              </td>
              <td class="text-end px-4 align-middle">
                <div class="btn-group gap-1">
                  <a href="/provider/products/show/{{ product.id }}" class="btn btn-sm btn-outline-warning"
                    data-bs-toggle="tooltip" title="Visualizar">
                    <i class="bi bi-eye"></i>
                  </a>
                  <a href="/provider/products/update/{{ product.id }}" class="btn btn-sm btn-outline-primary"
                    data-bs-toggle="tooltip" title="Editar">
                    <i class="bi bi-pencil"></i>
                  </a>
                  <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="tooltip"
                    onclick="confirmDelete('{{ product.id }}')" title="Excluir">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6" class="text-center py-5">
                <div class="text-muted">
                  <i class="bi bi-box display-6 d-block mb-3"></i>
                  <p class="mb-0">Nenhum produto encontrado</p>
                  <small>Clique em "Novo Produto" para adicionar</small>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Confirmação -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title">Confirmar Exclusão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Tem certeza que deseja excluir este produto?
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <a href="#" id="confirmDeleteBtn" class="btn btn-danger">Excluir</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block styles %}
<style>
  .hover-shadow {
    transition: all 0.3s ease;
  }

  .hover-shadow:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
  }

  .btn-group .btn {
    transition: all 0.2s;
  }

  .btn-group .btn:hover {
    transform: translateY(-1px);
  }

  .badge {
    font-weight: 500;
    padding: 0.5em 0.8em;
  }

  .table> :not(caption)>*>* {
    padding: 1rem 0.75rem;
  }
</style>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener( 'DOMContentLoaded', function () {
    // Inicializa tooltips
    var tooltipTriggerList = [].slice.call( document.querySelectorAll( '[data-bs-toggle="tooltip"]' ) )
    tooltipTriggerList.map( function ( tooltipTriggerEl ) {
      return new bootstrap.Tooltip( tooltipTriggerEl )
    } );

    // Busca
    const searchInput = document.getElementById( 'searchInput' );
    searchInput.addEventListener( 'input', function ( e ) {
      const searchTerm = e.target.value.toLowerCase();
      const rows = document.querySelectorAll( 'tbody tr' );

      rows.forEach( row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes( searchTerm ) ? '' : 'none';
      } );
    } );
  } );

  function confirmDelete( productId ) {
    const modal = new bootstrap.Modal( document.getElementById( 'deleteModal' ) );
    const confirmBtn = document.getElementById( 'confirmDeleteBtn' );
    confirmBtn.href = `/provider/products/delete/${productId}`;
    modal.show();
  }
</script>
{% endblock %}
