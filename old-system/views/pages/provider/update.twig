{% extends "layout.twig" %}

{% block content %}
<div class="container-fluid py-1">
	<!-- Cabeçalho -->
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1 class="h3 mb-0">
			<i class="bi bi-person-gear me-2"></i>Atualizar Perfil
		</h1>
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb mb-0">
				<li class="breadcrumb-item"><a href="/provider">Dashboard</a></li>
				<li class="breadcrumb-item"><a href="/settings">Perfil</a></li>
				<li class="breadcrumb-item active">Atualizar</li>
			</ol>
		</nav>
	</div>

	<form id="updateForm" action="/provider/update" method="POST" enctype="multipart/form-data">
		{{ csrf.field|raw }}
		<div class="row g-4">
			<!-- Dados Pessoais -->
			<div class="col-md-4">
				<div class="card border-0 shadow-sm h-100">
					<div class="card-header bg-transparent border-0">
						<h5 class="card-title mb-0">
							<i class="bi bi-person me-2"></i>Dados Pessoais
						</h5>
					</div>
					<div class="card-body">
						<div class="row g-3">
							<!-- Campos pessoais aqui -->
							{% include 'partials/provider/personal_fields.twig' %}
						</div>
					</div>
				</div>
			</div>

			<!-- Dados Profissionais -->
			<div class="col-md-4">
				<div class="card border-0 shadow-sm h-100">
					<div class="card-header bg-transparent border-0">
						<h5 class="card-title mb-0">
							<i class="bi bi-briefcase me-2"></i>Dados Profissionais
						</h5>
					</div>
					<div class="card-body">
						<div class="row g-3">
							<!-- Campos profissionais aqui -->
							{% include 'partials/provider/professional_fields.twig' %}
						</div>
					</div>
				</div>
			</div>

			<!-- Endereço -->
			<div class="col-md-4">
				<div class="card border-0 shadow-sm h-100">
					<div class="card-header bg-transparent border-0">
						<h5 class="card-title mb-0">
							<i class="bi bi-geo-alt me-2"></i>Endereço
						</h5>
					</div>
					<div class="card-body">
						<div class="row g-3">
							<!-- Campos de endereço aqui -->
							{% include 'partials/provider/address_fields.twig' %}
						</div>
					</div>
				</div>
			</div>

			<!-- Logo e Descrição -->
			<div class="col-12">
				<div class="card border-0 shadow-sm rounded-4 mb-4">
					<div class="card-header bg-transparent border-0 py-1">
						<h5 class="card-title mb-0 d-flex align-items-center">
							<i class="bi bi-info-circle-fill me-2 "></i>
							<span>Informações Adicionais</span>
						</h5>
					</div>
					<div class="card-body p-4">
						<div class="row align-items-start g-4">
							<!-- Coluna da Logo -->
							<div class="col-md-2 text-center">
								<div class="logo-upload-container">
									<div class="logo-preview-wrapper mb-3 p-3 bg-light rounded-3 hover-shadow">
										<img id="preview" src="{{ provider.logo ?: '/assets/img/img_not_found.png' }}" alt="Logo da empresa"
											class="logo-image img-fluid rounded-3 shadow-sm" width="150" height="150">
									</div>
									<div class="upload-controls">
										<label for="logo" class="btn btn-outline-primary upload-btn rounded-pill px-4">
											<i class="bi bi-camera-fill me-2" aria-hidden="true"></i>
											<span>Alterar Logo</span>
										</label>
										<input type="file" class="visually-hidden" id="logo" name="logo"
											accept="image/png,image/jpeg,image/jpg" aria-label="Selecionar nova logo" data-max-size="5242880">
									</div>
									<div class="upload-feedback mt-2">
										{{ flash('logo')|raw }}
									</div>
								</div>
							</div>

							<!-- Coluna da Descrição -->
							<div class="col-md-10">
								<div class="form-group">
									<label for="description" class="form-label fw-bold mb-3">
										Descrição Profissional
									</label>
									<textarea class="form-control form-control-lg shadow-sm rounded-3" id="description" name="description"
										rows="4" maxlength="250" placeholder="Descreva sua experiência profissional..."
										style="resize: none;">{{ provider.description }}</textarea>
									<div class="d-flex justify-content-end mt-2">
										<small class="text-muted">
											<span id="char-count-value" class="fw-semibold">250</span> caracteres restantes
										</small>
									</div>
									{{ flash('description')|raw }}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-12">
				<div class="card border-0 shadow-sm">
					<div class="card-body">
						<div class="form-check">
							<input class="form-check-input" type="checkbox" id="terms_accepted" name="terms_accepted" required>
							<label class="form-check-label" for="terms_accepted">
								Eu li e aceito os
								<a href="/terms-of-service" target="_blank">Termos de Serviço</a>
								e a
								<a href="/privacy-policy" target="_blank">Política de Privacidade</a>.
							</label>
							{{ flash('terms_accepted')|raw }}
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Botões de Ação -->
		<div class="d-flex justify-content-between align-items-center mt-4">
			<div class="d-flex gap-2">
				<button type="submit" class="btn btn-primary" id="updateButton">
					<i class="bi bi-check-circle me-2"></i>Atualizar Cadastro
				</button>
				<a href="/provider/profile" class="btn btn-outline-secondary">
					<i class="bi bi-x-circle me-2"></i>Cancelar
				</a>
			</div>
			<small class="text-muted">
				Última atualização: {{ provider.lastUpdated|date('d/m/Y H:i') }}
			</small>
		</div>
	</form>
</div>
{% endblock %}

{# Bloco de scripts #}
{% block scripts %}
{{ parent() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script src="/assets/js/modules/masks/index.js" type="module"></script>
<script src="/assets/js/modules/form-validation.js" type="module"></script>
<script src="/assets/js/modules/cep-service.js" type="module"></script>
<script src="/assets/js/modules/image-preview.js" type="module"></script>
<script src="/assets/js/modules/character-counter.js" type="module"></script>
<script src="/assets/js/provider_update.js" type="module"></script>
<script>
	document.getElementById( 'logo' ).addEventListener( 'change', function ( e ) {
		const file = e.target.files[0];
		const maxSize = this.dataset.maxSize;

		if ( file ) {
			// Validação de tamanho
			if ( file.size > maxSize ) {
				alert( 'O arquivo é muito grande. O tamanho máximo permitido é 5MB.' );
				this.value = '';
				return;
			}

			// Preview da imagem
			const reader = new FileReader();
			reader.onload = function ( e ) {
				document.getElementById( 'preview' ).src = e.target.result;
			}
			reader.readAsDataURL( file );
		}
	} );
</script>
{% endblock %}
